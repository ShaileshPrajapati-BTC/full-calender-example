<p id="notice"><%= notice %></p>

<h1>Events</h1>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Start time</th>
      <th>End time</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @events.each do |event| %>
      <tr>
        <td><%= event.title %></td>
        <td><%= event.description %></td>
        <td><%= event.start_time %></td>
        <td><%= event.end_time %></td>
        <td><%= link_to 'Show', event %></td>
        <td><%= link_to 'Edit', edit_event_path(event) %></td>
        <td><%= link_to 'Destroy', event, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Event', new_event_path %>
<div id="calendar"/>
<script type="text/javascript">
  $(document).ready(function() {
    $.LoadingOverlaySetup({
      color: "rgba(0, 0, 0, 0.4)",
    });
     $('#calendar').fullCalendar({
      header: {
                left: 'prev,next today',
                center: 'title',
                right: 'month,agendaWeek,agendaDay,list'
            },
      droppable: true,
      editable: true,
      eventDrop: function(event, delta, revertFunc) {
                  $.LoadingOverlay("show");
                  $.ajax({
                    url: '/events/'+event.id,
                    type: 'PUT',
                    data:  {event: {start_time: event.start.format(),end_time: event.start.format()}},
                    dataType: 'json'});
                    $.LoadingOverlay("hide");
                 },
      loading: function(bool) {
        if (bool) {
          $.LoadingOverlay("show");
        }
        else{
          delete progress;
          $.LoadingOverlay("hide");
        }
      },                 
      events: '/events.json',
      eventColor: '#378006',
      eventTextColor: '#fff'
     });
     $('.fc-day').on('click',function(){
        // alert($(this).data('date'));
     });
  });
  
</script>